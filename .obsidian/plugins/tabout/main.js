/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var M=Object.create;var m=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var R=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var T=a=>m(a,"__esModule",{value:!0});var D=(a,t)=>{T(a);for(var e in t)m(a,e,{get:t[e],enumerable:!0})},P=(a,t,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of S(t))!j.call(a,o)&&o!=="default"&&m(a,o,{get:()=>t[o],enumerable:!(e=A(t,o))||e.enumerable});return a},h=a=>P(T(m(a!=null?M(R(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var l=(a,t,e)=>new Promise((o,s)=>{var r=u=>{try{d(e.next(u))}catch(k){s(k)}},n=u=>{try{d(e.throw(u))}catch(k){s(k)}},d=u=>u.done?o(u.value):Promise.resolve(u.value).then(r,n);d((e=e.apply(a,t)).next())});D(exports,{default:()=>E});var b=h(require("obsidian"));var f=h(require("obsidian"));var c=h(require("obsidian")),g=class extends c.Modal{constructor(t,e,o){super(t.app);this.plugin=t,this.rule=e,this.idx=o}onOpen(){let{contentEl:t}=this;t.empty(),new c.Setting(t).setName("Environment").setClass("tabout-match-text").setDesc("The Codemirror Token for the Environment.").addText(o=>{o.setValue(this.rule.tokenMatcher).setPlaceholder("em").onChange(s=>{this.rule.tokenMatcher=s})}),new c.Setting(t).setName("Jump after the Characters").setClass("tabout-match-text").setDesc("If enabled the Cursor will be set after the Characters, otherwise before them.").addToggle(o=>{o.setValue(this.rule.jumpAfter).onChange(s=>{this.rule.jumpAfter=s})}),this.rule.lookups.forEach((o,s)=>{new c.Setting(t).setName(s===0?"Characters":"").setClass("tabout-jump-char").addExtraButton(r=>{r.setIcon("trash").onClick(()=>{this.rule.lookups.remove(this.rule.lookups[s]),this.onOpen()})}).addText(r=>{r.setValue(o).setPlaceholder("**").onChange(n=>{this.rule.lookups[s]=n})})}),new c.Setting(t).setClass("tabout-jump-char").addButton(o=>{o.setButtonText("Add Character").onClick(()=>{this.rule.lookups.push(""),this.onOpen()})});let e=createEl("button",{text:"Save Rule",cls:"tabout-add-rule"});e.onClickEvent(()=>{this.close()}),t.createDiv({cls:"tabout-add-rule-container"}).append(e)}onClose(){let{contentEl:t}=this;t.empty(),dispatchEvent(new CustomEvent("tabout-edit-complete",{detail:{rule:this.rule,idx:this.idx}}))}};var i=h(require("obsidian")),p=class extends i.Modal{constructor(t,e=""){super(t.app);this.plugin=t,this.rule={lookups:[""],tokenMatcher:e,jumpAfter:!0}}onOpen(){let{contentEl:t}=this;t.empty(),new i.Setting(t).setName("Environment").setClass("tabout-match-text").setDesc("The Codemirror Token for the Environment.").addText(s=>{s.setValue(this.rule.tokenMatcher).setPlaceholder("em").onChange(r=>{this.rule.tokenMatcher=r})}),new i.Setting(t).setName("Jump after the Characters").setClass("tabout-match-text").setDesc("If enabled the Cursor will be set after the Characters, otherwise before them.").addToggle(s=>{s.setValue(this.rule.jumpAfter).onChange(r=>{this.rule.jumpAfter=r})}),this.rule.lookups.forEach((s,r)=>{new i.Setting(t).setName(r===0?"Characters":"").setClass("tabout-jump-char").addExtraButton(n=>{n.setIcon("trash").onClick(()=>{this.rule.lookups.remove(this.rule.lookups[r]),this.onOpen()})}).addText(n=>{n.setValue(s).setPlaceholder("**").onChange(d=>{this.rule.lookups[r]=d})})}),new i.Setting(t).setClass("tabout-jump-char").addButton(s=>{s.setButtonText("Add Character").onClick(()=>{this.rule.lookups.push(""),this.onOpen()})});let e=createEl("button",{text:"Add this Rule",cls:"tabout-add-rule"});e.onClickEvent(()=>{this.rule.lookups.length>=1&&this.rule.lookups.first()?(this.save(),this.close()):new i.Notice("Something is still Missing")});let o=createEl("button",{text:"Cancel",cls:"tabout-add-rule"});o.onClickEvent(()=>{this.close()}),t.createDiv({cls:"tabout-add-rule-container"}).append(e,o)}onClose(){let{contentEl:t}=this;t.empty()}save(){dispatchEvent(new CustomEvent("tabout-rule-create",{detail:{rule:this.rule}}))}};var C=class extends f.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e,addEventListener("tabout-edit-complete",o=>l(this,null,function*(){this.plugin.settings.rules[o.detail.idx]=o.detail.rule,this.display(),yield this.plugin.saveSettings()})),addEventListener("tabout-rule-create",o=>l(this,null,function*(){this.plugin.settings.rules.push(o.detail.rule),this.display(),yield this.plugin.saveSettings()}))}display(){let{containerEl:t}=this,{settings:e}=this.plugin;t.empty(),t.createEl("h2",{text:"Obsidian Tabout"}),e.rules.forEach((s,r)=>{new f.Setting(t).setName(`Rule #${r}`).setDesc(this.generateDescription(s)).addButton(n=>{n.setButtonText("Edit").onClick(()=>{new g(this.plugin,s,r).open()})}).addExtraButton(n=>{n.setIcon("trash").setTooltip("Delete Rule").onClick(()=>l(this,null,function*(){e.rules.remove(s),yield this.plugin.saveSettings(),this.display()}))})});let o=createEl("button",{text:"Add Rule",cls:"tabout-add-rule"});o.onClickEvent(()=>{new p(this.plugin).open()}),t.createDiv({cls:"tabout-add-rule-container"}).append(o)}generateDescription(t){let e=document.createDocumentFragment();return e.append("This Rule is only active in "),e.append(createEl("code",{text:t.tokenMatcher?t.tokenMatcher:"all"})),e.append(" Environments and with the press of "),e.append(createEl("kbd",{text:"Tab",cls:"tabout-kbd"})),e.append(" you will jump to one of these characters: "),t.lookups.forEach((o,s)=>{e.append(createEl("code",{text:o})),s!=t.lookups.length-1&&e.append(", ")}),e}};var x={rules:[{tokenMatcher:"hmd-internal-link",lookups:["]]"],jumpAfter:!0},{tokenMatcher:"strong",lookups:["**"],jumpAfter:!0},{tokenMatcher:"em",lookups:["*"],jumpAfter:!0},{tokenMatcher:"code",lookups:["`"],jumpAfter:!0},{tokenMatcher:"math",lookups:["{","("],jumpAfter:!0}]};var v=h(require("@codemirror/view")),y=h(require("@codemirror/state")),w=h(require("@codemirror/language")),E=class extends b.Plugin{constructor(){super(...arguments);this.getToken=t=>(0,w.syntaxTree)(t).resolveInner(t.selection.main.head,-1).type.name;this.tabout=t=>{for(let e of this.settings.rules)if(t.contains(e.tokenMatcher)){let o=this.app.workspace.getActiveViewOfType(b.MarkdownView).editor,s=o.getCursor(),r=o.getLine(s.line).substring(s.ch),n=Math.min(...this.getIndices(e.lookups,r,e.jumpAfter));if(n!=1/0)return o.setCursor(s.line,s.ch+n),!0}return!1};this.legacyTabout=(t,e)=>{if(e.text.first()==="	"){let o=t.getTokenTypeAt(t.getCursor());this.tabout(o)&&e.cancel()}}}onload(){return l(this,null,function*(){yield this.loadSettings(),this.legacy=this.app.vault.config.legacyEditor,this.legacy?this.registerCodeMirror(t=>{t.on("beforeChange",this.legacyTabout)}):this.registerEditorExtension(y.Prec.high(v.keymap.of([{key:"Tab",run:t=>this.tabout(this.getToken(t.state))}]))),this.addSettingTab(new C(this.app,this)),this.addCommand({id:"tabout-add-rule-here",name:"Add Rule for this Environment",editorCallback:t=>{let e="";this.legacy?e=t.cm.getTokenTypeAt(t.getCursor()):e=this.getToken(t.cm.state),new p(this,e).open()}})})}getIndices(t,e,o){let s=[];return t.forEach(r=>{let n=e.indexOf(r);n!=-1&&s.push(o?n+r.length:n)}),s}onunload(){this.legacy&&this.app.workspace.iterateCodeMirrors(t=>t.off("beforeChange",this.legacyTabout))}loadSettings(){return l(this,null,function*(){this.settings=Object.assign({},x,yield this.loadData())})}saveSettings(){return l(this,null,function*(){yield this.saveData(this.settings)})}};
